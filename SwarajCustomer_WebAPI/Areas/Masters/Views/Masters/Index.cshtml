@using SwarajCustomer_Common.ViewModel
@model BulkUpload
@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    ViewBag.Title = "Manager Masters";
    ViewBag.Menu = "Dashboard";
    ViewBag.SubMenu = "Index";
}
<div class="col-sm-9 rightbox">
    <div class="fullwidth top">
        <div class="topheader">
            <h1 class="col-sm-6 headingbox" style="position: relative; top:8px;padding-left: 0;">@ViewBag.Title</h1>
            <div class="col-sm-6 rightitems">
                <a class="creatbtn UPLOAD" style="cursor: pointer; margin-right: 10px;" onclick="GetUploadPopup();">
                    <span>Bulk Upload</span>
                </a>
                <a class="creatbtn" data-toggle="modal" data-target="#logoutModal2" style="cursor: pointer;
    right: 20px;" onclick="ManageMasters()">
                    <span>Add</span>
                </a>
                <a class="excels export btn" style="cursor:pointer" onclick="exportInExcel();return false;" id="save_excel" title="Export To Excel">
                    <span>Export To Excel</span>
                </a>

                <a class="excels export btn combos" data-toggle="modal" data-target="#logoutModal3" style="cursor: pointer;
    right: -15px;" onclick="ManageMasters()">
                    <i class="images" ><img src="~/Content/images/icons/ic_combo_packages.png" /></i>
                    <span>Combos-Packages-Service</span>
                </a>
            </div>

        </div>


    </div>
    <div class="barwidths" id="adminDashboardLeads">
        <div class="searchfilter">
            <div class="datefilter"></div>  
            <div class="col-sm-3 searchbox category">
                <label>Catagory : </label>
                <select class="form-control selectoption" id="MasterPageType" name="Catagory"></select>
            </div>
            <div class="searchresult">
                <button id="anc_search" class="btn btn-success yes">Search</button>
                <button id="reset" class="btn btn-danger No">Reset</button>
            </div>
            <section class="counts" style="width: 100%; display: inline-block; float: right;">
                <div class="pull-right countsboxs" style="width: auto; float: right !important;position: relative; top: -10px;left: 7px;">
                    <div style="display:inline-block;margin-right:5px;">
                        <span>Show</span>
                        <select class='form-control selectoption' id='NoofRecords' name='NoofRecords'>
                            <option value='10'>10</option>
                            <option value='20'>20</option>
                            <option value='30'>30</option>
                            <option value='50'>50</option>
                            <option value='100'>100</option>
                            <option value='150'>150</option>
                            <option value='200'>200</option>
                            <option value='250'>250</option>
                            <option value='300'>300</option>
                            <option value='350'>350</option>
                            <option value='400'>400</option>
                            <option value='500'>500</option>
                        </select>
                        <span>Records</span>
                    </div>
                </div>
            </section>
        </div>
        <div class="table-container" id="divGrid">
        </div>
        <div class="table-container" id="divNoData">
        </div>
    </div>
</div>

<!-- Activw-inactive  Popup Design -->
<div id="logoutModal1" class="modal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <!-- Modal content-->
        <input type="hidden" id="hddId" />
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit</h4>
                <button type="button" id="closechassismodel" class="close" data-dismiss="modal" data-name="" onclick="ClearFields()"><img src="~/Content/images/croxxicon.png"></button>
            </div>
            <div class="modal-body">
                <div class="centerdiv">
                    <div class="col-sm-4 searchbox">
                        <label>Category</label>
                        <div class="middlewith">
                            <span style="color:green" class="validation" id="spnCatagoryName"></span>
                        </div>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Name</label>
                        <input type="text" class="form-control alphaNumericOnly" id="txtName" />
                        <span style="color:red" class="validation" id="spnName"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Description</label>
                        <input type="text" class="form-control alphaNumericOnly" id="txtDescription" />
                        <span style="color:red" class="validation" id="spnDescription"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>MRP</label>
                        <input type="text" class="form-control decimalOnly" id="txtMRP" />
                        <span style="color:red" class="validation" id="spnMRP"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Duration (m)</label>
                        <input type="text" class="form-control numberOnly" id="txtDuration" />
                        <span style="color:red" class="validation" id="spnDuration"></span>
                    </div>

                    <div class="col-sm-4 searchbox">
                        <label>Status</label>
                        <div class="middlewith">
                            <label><input type="radio" class="" name="Status" id="Active" value="Y">Active</label>
                            <label><input type="radio" class="" name="Status" id="Inactive" value="N">Inactive</label>
                        </div>
                    </div>
                </div>
                <div class="buttonsenterbox margintops">
                    <button class="btn btn-success yes" id="btn_save" onclick="Update()">Submit</button>
                    <button class="btn btn-danger No" data-dismiss="modal" id="btnlogoutno" onclick="ClearFields()">Cancel  </button>
                </div>
            </div>

        </div>
    </div>
</div>

<div id="logoutModal2" class="modal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add</h4>
                <button type="button" id="closechassismodel" class="close" data-dismiss="modal" data-name="" onclick="ClearFields()"><img src="~/Content/images/croxxicon.png"></button>
            </div>
            <div class="modal-body">
                <div class="centerdiv">
                    <div class="col-sm-4 searchbox">
                        <label>Catagory</label>
                        <select class="form-control selectoption" id="AddCatagory" name="Catagory"></select>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Name</label>
                        <input type="text" class="form-control alphaNumericOnly" id="AddName" />
                        <span style="color:red" class="validation" id="1"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Description</label>
                        <input type="text" class="form-control alphaNumericOnly" id="AddDescription" />
                        <span style="color: red;" class="validation" id="2"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>MRP</label>
                        <input type="text" class="form-control decimalOnly" id="AddMRP" />
                        <span style="color: red;" class="validation" id="3"></span>
                    </div>


                    <div class="col-sm-4 searchbox">
                        <label>Duration</label>
                        <input type="text" class="form-control numberOnly" id="AddDuration" />
                        <span style="color: red;" class="validation" id="4"></span>
                    </div>

                </div>
                <div class="buttonsenterbox margintops">
                    <button class="btn btn-success yes" id="btn_save" onclick="Save()">Submit</button>
                    <button class="btn btn-danger No" data-dismiss="modal" id="btnlogoutno" onclick="ClearFields()">Cancel</button>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- End Logout -->
<!-- Bulk Upload -->
<div id="XlUpload" class="modal fade upload-modal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" onclick="CloseExcel();">×</button>
                <h4 class="modal-title"><b>BULK UPLOAD</b></h4>
                <p>Upload Excel File (.xlsx or .xls)</p>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("Index", "Masters", FormMethod.Post, new { @id = "Form_id", enctype = "multipart/form-data" }))
                {
                    <div class="col-sm-12 boxone" style="padding:0 0;">
                        <label class="full-label"></label>
                        <div class="radio-container">
                            @Html.RadioButtonFor(a => a.CategoryID, 1, new { @checked = "checked", @id = "rdbPuja" })
                            <label for="rdbSales"><span></span>Puja</label>
                        </div>
                        <div class="radio-container">
                            @Html.RadioButtonFor(a => a.CategoryID, 2, new { @id = "rdbPath" })
                            <label for="rdbService"><span></span>Path</label>
                        </div>
                        <div class="radio-container">
                            @Html.RadioButtonFor(a => a.CategoryID, 3, new { @id = "rdbCorpPuja" })
                            <label for="rdbService"><span></span>Corporate Puja</label>
                        </div>
                    </div>

                    <div class="pull-left">
                        <p><b>NOTE:</b> Please ensure that the columns names in the .xlsx or .xls file, that you are uploading, matches to the column names in the template. Also, the Duration should be in minutes. Click the link "Download Template" to download template.</p>
                    </div>

                    <div class="text-center col-md-12 fileSelection">
                        <div class="drag-drop pull-left">
                            <a href="javascript:void(0)" onclick="GetSampleExcel();"><img src="~/Content/images/Excel_icon.png"></a>
                            <label><a href="javascript:void(0)" onclick="GetSampleExcel();">Download Template</a></label>
                        </div>
                        <div class="inputfile-box pull-left">
                            <input type="file" name="file-5[]" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" id="file-5" class="inputfile inputfile-4" data-multiple-caption="{count} files selected" multiple="" onchange="getFileData(this);">
                            <label for="file-5">
                                <span class="file-button">
                                    <img src="~/Content/images/select-file.png" alt="select file" title="select file">
                                </span>

                                <span class="slectFile">Select a File</span>

                            </label>
                        </div>
                        <span id="file-name"></span>
                    </div>
                    <div class="col-sm-12" id="DivSubmit">
                        <button type="submit" class="btn btn-success yes">Upload</button>
                    </div>
                    <div class="col-sm-12">
                        <span id="spn_errormessage"></span>
                    </div>
                    <div class="text-center col-md-12 fileSelection" id="divExcelError">

                    </div>
                }
                <div class="col-sm-12" id="DivLoader"></div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>


<div id="logoutModal3" class="modal" role="dialog" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> <span id="spnCombosPackages">Add Combos-Packages-Service</span></h4>
                <button type="button" id="closechassismodel" class="close" data-dismiss="modal" data-name="" onclick="ClearFields()"><img src="~/Content/images/croxxicon.png"></button>
            </div>
            <div class="modal-body">
                <div class="centerdiv">
                    <div class="col-sm-4 searchbox">
                        <label>Catagory</label>
                        <select class="form-control selectoption" id="CombosPackagesCatagory"></select>
                        <span style="color:red" class="validation" id="spnCombosPackagesCatagory"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Sub Catagory</label>
                        <select class="form-control selectoption" id="CombosPackagesSubCatagory"></select>
                        <span style="color:red" class="validation" id="spnCombosPackagesSubCatagory"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Name</label>
                        <input type="text" class="form-control alphaNumericOnly" id="CombosPackagesName" />
                        <span style="color:red" class="validation" id="spnCombosPackagesName"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Description</label>
                        <input type="text" class="form-control alphaNumericOnly" id="CombosPackagesDescription" />
                        <span style="color: red;" class="validation" id="spnCombosPackagesDescription"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>MRP</label>
                        <input type="text" class="form-control decimalOnly" id="CombosPackagesMRP" />
                        <span style="color: red;" class="validation" id="spnCombosPackagesMRP"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Discount</label>
                        <input type="text" class="form-control decimalOnly" id="CombosPackagesDiscount" />
                        <span style="color: red;" class="validation" id="spnCombosPackagesDiscount"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Duration</label>
                        <input type="text" class="form-control numberOnly" id="CombosPackagesDuration" />
                        <span style="color: red;" class="validation" id="spnCombosPackagesDuration"></span>
                    </div>
                    <div class="col-sm-4 searchbox">
                        <label>Status</label>
                        <div class="middlewith">
                            <label><input type="radio" style="cursor:pointer" name="CombosPackagesStatus" id="Active" value="Y" checked>Active</label>
                            <label><input type="radio" style="cursor:pointer" name="CombosPackagesStatus" id="Inactive" value="N">Inactive</label>
                        </div>
                    </div>
                </div>
                <div class="buttonsenterbox margintops">
                    <button class="btn btn-success yes" id="btn_save" onclick="SaveCombosPackages()">Submit</button>
                    <button class="btn btn-danger No" data-dismiss="modal" id="btnlogoutno" onclick="ClearFields()">Cancel</button>
                </div>
            </div>

        </div>
    </div>
</div>


<style>
    .col-sm-3.searchbox.category {
        width: 30%;
    }

    .col-sm-3.searchbox select.form-control.selectoption {
        width: 75%;
        float: right;
        padding: 0;
    }

    a.excels.export.btn.combos {
        background: orange;
        color: #fff;
        height: 32px;
        position: relative;
        top: -1px;
        font-size: 14px;
        font-weight: 600;
        line-height: 18px;
    }

    span#spn_errormessage {
        color: red;
        position: absolute;
        font-size: 16px;
        font-weight: bold;
        left: 0;
        right: 0;
        text-align: center;
        bottom: -13px;
    }

    .col-sm-3.searchbox.category select#MasterPageType {
        width: 72%;
    }

    div#logoutModal2 .modal-dialog {
        width: 50%;
    }

    div#logoutModal1 .modal-dialog {
        width: 50%;
    }

    #logoutModal2 .col-sm-4.searchbox, #logoutModal1 .col-sm-4.searchbox, #logoutModal3 .col-sm-4.searchbox {
        max-width: 100%;
        text-align: left;
        margin-bottom: 30px;
    }

    div#logoutModal1 .col-sm-6.searchbox, {
        text-align: left;
    }

    .col-sm-12.searchbox.radiobox {
        padding-top: 20px;
        text-align: left;
    }

        .col-sm-12.searchbox.radiobox .col-sm-12 {
            padding: 0;
        }

        .col-sm-12.searchbox.radiobox input {
            margin: 3px 10px 0 10px;
            position: relative;
            top: 2px;
        }

    .middlewith {
        width: 100%;
        float: left;
        margin: auto;
    }

        .middlewith label {
            margin-right: 10px;
        }

            .middlewith label input {
                margin-right: 10px;
                margin-top: 5px;
                position: relative;
                top: 2px;
            }

    span#spnName {
        position: absolute;
        bottom: -22px;
    }
</style>

<script src="~/Scripts/function.js"></script>
<script src="~/Areas/Scripts/masters.js"></script>
<script type="text/javascript">
	var $_DownloadSampleExcel='@Url.Action("DownloadSampleExcel", "Masters", new { Area = "Masters" })';
    var $_ErrorMessage = '@ViewBag.ErrorMessage';
    var $_WrongData = @Html.Raw(Json.Encode(@ViewBag.WrongData));
    var message = $_ErrorMessage;
    var wrong_data = $_WrongData;

    if (message != null && message != "") {
        $('#spn_errormessage').text(message);
        $('#XlUpload').modal('show');
        $('#spn_errormessage').show();

        // error tables
        if (wrong_data.length > 0) {
            debugger;
            var tableHTML = "<table class='table table-bordered table-responsive table-hover'>" +
                "<thead><tr> <td>Row #</td> <td>Error Message</td></tr></thead> ";
            var i = 1;
            $.each(wrong_data, function (i, obj) {
                tableHTML = tableHTML + "<tr><td>" + i++ + "</td><td>" + this['ErrorMessage'] + "</td></tr>";
            });
            tableHTML = tableHTML + "</table>";
            $("#divExcelError").html(tableHTML)
        }
    }




    AlphaNumericOnly('.alphaNumericOnly');
    NumberOnly('.numberOnly');
    DecimalOnly('.decimalOnly');
    var $_GetMastersUrl = '@Url.Action("GetMastersGridView", "Masters", new { Area = "Masters" })';
    var $_GetUpdateUrl = '@Url.Action("Update", "Masters", new { Area = "Masters" })';
    var $_GetCategory = '@Url.Action("GetCategory", "Masters", new { Area = "Masters" })';
    var $_GetSaveUrl = '@Url.Action("Save", "Masters", new { Area = "Masters" })';
    var $_GetEditUrl = '@Url.Action("Edit", "Masters", new { Area = "Masters" })'
    var $_ExcelDownLoadUrl = '@Url.Action("ExcelDownLoad", "Masters", new { Area = "Masters" })';

    var $_GetMasterCategorys = '@Url.Action("GetMasterCategorys", "Advertising", new { Area = "Advertising" })';
    var $_GetSaveUpdateCombosPackagesUrl = '@Url.Action("SaveUpdateCombosPackages", "Masters", new { Area = "Masters" })';

    var current_page = 0;
    $(document).ready(function () {
        $("#divNoData").addClass("hide");
        GetCategory();
        GetMastersData();
    });

    $(document).on("change", "#NoofRecords", function () {
        GetMastersData();
    });
    $("#anc_search").click(function () {
        GetMastersData();
    });
    $("#reset").click(function () {
        window.location.reload();
    });

    function GetUploadPopup() {
        $('#file-name').html('');
        $('#XlUpload').modal('show');
        $('#divExcelError').addClass('hide');
    }

    function GetSampleExcel() {
        window.location.href = $_DownloadSampleExcel;
    }

    function getFileData(myFile) {
        var file = myFile.files[0];
        var filename = file.name;
        $('#file-name').html(filename);
        $('#file-name').addClass("boxexel");
    }

    function CloseExcel() {
        debugger;
        $('#file-name').html('');
        $('#file-5').val('');
        $('#divExcelError').addClass('hide');
        $('#spn_errormessage').hide();
        location.href = '@Url.Action("Index", "Masters", new { Area = "Masters" })';
    }
</script>