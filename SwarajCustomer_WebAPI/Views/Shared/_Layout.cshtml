@using SwarajCustomer_Common;
@using SwarajCustomer_Common.Utility;

@{
    var controller = ViewContext.RouteData.Values["Controller"];
    var action = ViewContext.RouteData.Values["Action"];
    var Server_Url = CommonMethods.BaseUrl;

    string image_icon = CommonMethods.AdvertismentIcon;
    string img_exts = CommonMethods.ImageFileExtensions;
    int img_size_maximum = CommonMethods.ImageSizeMaximum;
    int img_size_minimum = CommonMethods.ImageSizeMinimum;

    //  advertisment vedio//

    string vedio_icon = CommonMethods.AdvertismentVideosIcon;
    string vedio_exts = CommonMethods.VideoFileExtensions;
    int vedio_size_maximum = CommonMethods.VideoSizeMaximum;
    int vedio_size_minimum = CommonMethods.VideoSizeMinimum;

}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Puja Guru</title>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="~/Content/images/icons/Favicon.png" />
    <link rel="stylesheet" type="text/css" href="~/Content/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="~/Content/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="~/Content/css/animate.css">
    <link rel="stylesheet" type="text/css" href="~/Content/css/util.css">
    <link rel="stylesheet" type="text/css" href="~/Content/css/main.css">
    <link href="~/Content/css/jquery-ui.css" rel="stylesheet" />
    <link href="~/Content/css/toastr.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/Content/css/zoom.css" />

    <!-- for bootstrap  datetimepicker-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.3/css/bootstrapValidator.min.css">
    <!-- for kendo  muiltiple dropdown-->
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2017.3.913/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2017.3.913/styles/kendo.default.min.css" />

    <!-- for bootstrap  muiltiple dropdown-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">



    <!--===============================================================================================-->
    <script src="~/Scripts/jquery.min.js"></script>
    <script src="~/Scripts/jquery-ui.js" type="text/javascript"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/main.js"></script>
    <script src="~/Scripts/function.js"></script>
    <script src="~/Scripts/SetToastr.js"></script>
    <script src="~/Scripts/toastr.min.js"></script>
    <script src="~/Scripts/SessionExpire.js"></script>
    <script src="~/Scripts/moment.min.js"></script>
    <script src="~/Scripts/jquery.star-rating-svg.js"></script>
    <script src="~/Scripts/zoom.js"></script>
    <script src="~/Scripts/jquery.emojiRatings.min.js"></script>
    <script src="~/Scripts/global_state_district.js"></script>
    <script src="~/Scripts/get_latitude_longitute.js"></script>



    <!-- Bootsrap datetimepicker  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.3/js/bootstrapValidator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/js/bootstrap-datetimepicker.min.js"></script>
    <!-- kendo  muiltiple dropdowns  -->
    <script src="https://kendo.cdn.telerik.com/2017.3.913/js/kendo.all.min.js"></script>

    <!-- Bootsrap dropdowns  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>

    @Scripts.Render("~/bundles/jquery")
    @RenderSection("scripts", required: false)


</head>
<body class="bg ">
    <div class="topheaderbg">
        <div class="col-sm-3">
            <a class="logoimages" href="~/DashBoard/DashBoard/Index">
                <img src="~/Content/images/newlogo.png" />
            </a>

        </div>
        <div class="col-sm-3 pull-right rightnav">
            <li class="dropdown">
                <a href="javascript:void(0);" tabindex="0" title="" data-toggle="dropdown" aria-expanded="false">
                    <span class="user-name"> @Session[SwarajCustomer_Common.Utility.SystemVariables.UserName] </span>
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li>
                        <a data-toggle="modal" data-target="#ChangePassword" title="ChangePassword">
                            <i class="images"><img src="~/Content/images/ChangePassword.png"></i>
                            <span class="menutext">Change Password</span>
                        </a>
                    </li>
                    <li class="nav-item logout">
                        <a data-toggle="modal" data-target="#logoutModal">
                            <i class="images">
                                <img src="~/Content/images/logout.png">
                            </i>
                            <span class="menutext">Logout</span>
                        </a>
                    </li>

                </ul>
            </li>
            <span class="admin-name">

            </span>

        </div>
    </div>

    <div class="margintop">

        <div class="col-sm-3 leftboxmenu">
            <a id="menuToggle" class="rightmenubox menutoggle toggle"></a>
            <div id='cssmenu' class="naviagtion" style="cursor:pointer">
                <ul class="dashnoardlinks">
                    <li>
                        <a href="~/DashBoard/DashBoard/Index" data-controller="dashboard" title="Dashboard">
                            <i class="images"><img src="~/Content/images/home.png"></i>
                            <span class="menutext">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/ManageUser/ManageUser/Index" data-controller="manageuser" title="Manage User">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_user.png" />
                            </i>
                            <span class="menutext">Manage User</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/ManageOrder/ManageOrder/Index" data-controller="manageorder" title="Manage Order">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_checklist.png" />
                            </i>
                            <span class="menutext">Manage Order</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/Masters/Masters/Index" data-controller="masters" title="Manage Masters">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_master.png" />
                            </i>
                            <span class="menutext">Manage Masters</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/Advertising/Advertising/Index" data-controller="advertising" title="Manage Advertising">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_ads.png" />
                            </i>
                            <span class="menutext">Manage Advertising</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/ManagePayment/ManagePayment/Index" data-controller="managepayment" title="Manage Payment">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_payment.png" />
                            </i>
                            <span class="menutext">Manage Payment</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/ManageFavVideos/ManageFavVideos/Index" data-controller="managefavvideos" title="Manage Fav Videos">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_manage_ads.png" />
                            </i>
                            <span class="menutext">Manage Fav Videos</span>
                        </a>
                    </li>
                    <li>
                        <a href="~/PurohitCustomerLinking/PurohitCustomerLinking/Index" data-controller="purohitcustomerlinking" title="Purohit/Customer Linking">
                            <i class="images">
                                <img src="~/Content/images/icons/ic_linking.png" />
                            </i>
                            <span class="menutext">Purohit/Customer Linking</span>
                        </a>
                    </li>
                    <li class="logoutbottom">
                        <a data-toggle="modal" data-target="#logoutModal" title="Logout">
                            <i class="images"><img src="~/Content/images/logoutwhite.png"></i>
                            <span class="menutext">Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        @RenderBody()


    </div>
    <!-- Logout Popup Design -->
    <div id="logoutModal" class="modal" role="dialog" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Are you sure you want to logout?</h4>
                </div>
                <div class="modal-body">
                    <div class="buttonsenterbox">
                        <a href="~/Account/User/LogOut" class="logout">
                            <button class="btn btn-success yes">Yes</button>
                        </a>
                        <button class="btn btn-danger No" data-dismiss="modal" id="btnlogoutno">No</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--Main Popup Design  -->
    <div id="modalconfirm" class="modal fade addcomp" role="dialog" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-body">
                    <h4 class="modal-title text" style="    margin-bottom: 20px;">
                        <span id="spnconfirm" class="modal-header" style="text-align:center;width: 100%; display: inline-block;">

                        </span>

                    </h4><h4></h4>
                    <div class="buttonsenterbox">
                        <div class="row center" style="text-align:  center; ">
                            <button id="btn_confirmyes" class="btn btn-success yes" style="margin-right:10px;">Yes</button>
                            <button id="btn_confirmno" onclick="return closePopop()" class="btn btn-danger No">No</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Alert Modal -->
    <div id="modalAlert" class="modal fade addcomp" role="dialog" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-body">
                    <h4 class="modal-title text" style="margin-bottom: 20px;">
                        <span id="spnAlert" class="modal-header" style="text-align: center; width: 100%; display: inline-block;">
                        </span>
                    </h4><h4></h4>
                    <div class="row center" style="text-align:  center; ">
                        <button id="btn_confirmok" onclick="return closeAlert()" class="btn btn-danger No">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="ChangePassword" class="modal" role="dialog" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">

            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><span id="title">Change Password</span></h4>
                    <button type="button" id="closechassismodel" class="close" data-dismiss="modal" data-name="" onclick="Cancel()"><img src="~/Content/images/croxxicon.png"></button>
                </div>
                <div class="modal-body">
                    <div class="centerdiv">
                        <input type="hidden" value="@Session[SwarajCustomer_Common.Utility.SystemVariables.UserId]" id="txtUserId" name="UserId" />

                        <div class="col-sm-4 searchbox">
                            <label>Old Password  </label>
                            <input type="text" class="form-control" name="OldPassword" id="OldPassword"
                                   value="@Session[SwarajCustomer_Common.Utility.SystemVariables.Password]" readonly />
                            <span style="color:red" class="validation" id="spnCurrentPassword"></span>
                        </div>
                        <div class="col-sm-4 searchbox">
                            <label>New PassWord  </label>
                            <input type="password" class="form-control" data-val-equalto="New Password  must match." data-val-equalto-other="*.Password" data-val-required="Required." id="PassWord" name="PassWord" data-toggle="password" />
                            <div class="input-group-append eyeicon">
                                <span class="input-group-text"><i class="fa fa-eye"></i></span>
                            </div>
                            <span style="color:red" class="validation" id="spnPassword"></span>
                        </div>
                        <div class="col-sm-4 searchbox">
                            <label>Confirm Password  </label>
                            <input type="password" class="form-control" data-val-equalto="Password and Confirmation Password must match." data-val-equalto-other="*.Password" data-val-required="Required." id="ConfirmPassword" name="ConfirmPassword" data-toggle="password" />
                            <div class="input-group-append eyeicon">
                                <span class="input-group-text"><i class="fa fa-eye"></i></span>
                            </div>
                            <span style="color:red" class="validation" id="spnConfirmPassword"></span>
                        </div>
                    </div>
                    <div class="buttonsenterbox margintops">
                        <button class="btn btn-success yes" id="btn_save" onclick="ChangePassword()">Submit</button>
                        <button class="btn btn-danger No" data-dismiss="modal" id="btnlogoutno" onclick="Cancel()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var gbl_row_count = 0;

        var $_Latitude = "";
        var $_Longitude = "";
        var $_GetStatetUrl = "";
        var $_GetDistrictUrl = "";
        var $_GetSearchUrl = "";

     var $_GetDashBoard = '@Url.Action("Index", "DashBoard", new { Area = "DashBoard" })';
     var gbl_login_url = '@Url.Action("Login", "User", new { Area = "Account" })';
     var gbl_session_expire_url = '@Url.Action("SessionExpire", "User", new { Area = "Account" })';
     var gbl_unauthorized_url = '@Url.Action("UnAuthorized", "User", new { Area = "Account" })';
     var $_ChangePassword = '@Url.Action("ChangePassword", "User", new { Area = "Account" })';



     var $_authorization = '@Session[SwarajCustomer_Common.Utility.SystemVariables.Authorization]';
     var $_RoleName = '@Session[SwarajCustomer_Common.Utility.SystemVariables.RoleName]';

        var controllerName = '@controller';
        var viewName = '@action';

        var $_Image = '@Url.Content(image_icon)';
        var img_ext ='@img_exts';
        var img_size_maximum = @img_size_maximum;
        var img_size_minimum = @img_size_minimum;


        //  Advertisment  vedios

        var $_vedio_icon = '@Url.Content(vedio_icon)';
        var vedio_ext ='@vedio_exts';
        var vedio_size_maximum = @vedio_size_maximum;
        var vedio_size_minimum = @vedio_size_minimum;

        if ('@Server_Url'.indexOf('AgriGuru') >= 1) {
            $_GetSearchUrl = '/AgriGuru/Search/Search/';
            $_GetStatetUrl = '/AgriGuru/StateDistrict/GetState/';
            $_GetDistrictUrl = '/AgriGuru/StateDistrict/GetDistrict/';

        }
        else if ('@Server_Url'.indexOf('PujaGuru') >= 1) {
            $_GetSearchUrl = '/PujaGuru/Search/Search/';
            $_GetStatetUrl = '/PujaGuru/StateDistrict/GetState/';
            $_GetDistrictUrl = '/PujaGuru/StateDistrict/GetDistrict/';
        }
        else {
            $_GetSearchUrl = '/Search/Search/';
            $_GetStatetUrl = '/StateDistrict/GetState/';
            $_GetDistrictUrl = '/StateDistrict/GetDistrict/';
        }



        $(".dashnoardlinks li").each(function () {
            if ($(this).hasClass("active")) {
                $(this).removeClass("active");
            }
        });
        $(".dashnoardlinks li li").each(function () {
            if ($(this).hasClass("active")) {
                $(this).removeClass("active");
            }
        });
        $("#cssmenu > ul > li > a").click(function () {
            //$("#loaderContainer").show();

            var checkElement = $(this).next();
            $("#cssmenu li").removeClass("active");
            $(this).closest("li").addClass("active");
            if (checkElement.is("ul") && checkElement.is(":visible")) {
                $(this).closest("li").removeClass("active");
                checkElement.slideUp("normal");
            }
            if (checkElement.is("ul") && !checkElement.is(":visible")) {
                $("#cssmenu ul ul:visible").slideUp("normal");
                checkElement.slideDown("normal");
            }

            if ($(this).closest("li").find("ul").children().length == 0) {
                return true;
            } else {
                return false;
            }
        });
        $(".dashnoardlinks a").each(function () {
            if ($(this).data('controller') == controllerName.toLowerCase()) {
                if ($(this).data('controller') == "dashboard") {
                        $(this).closest("li").addClass("active");
                }  else {
                    $(this).closest("li").addClass("active");
                }
            }
        });


     var gbl_loader_html = '<p align="center" id="loaderimages">  <img src="../../Content/images/loader_30x30.gif" alt="processing... please wait" title="processing... please wait" width="40" height="40" /></p>';


            // add by lalit sharma 05/02/2020
            function ConfirmationMsg(message, callback = null) {
                $("#modalconfirm").modal('show');
                $("#spnconfirm").html(message);
                $("#btn_confirmyes").off('click').click(function () {
                    if (callback != null) {
                        callback();
                    }
                });
            }

            function closePopop() {
                $("#modalconfirm").modal('hide');
        }

        function ShowGlobalAlert(message) {
            $("#modalAlert").modal('show');
            $("#spnAlert").html(message);
        }

        function closeAlert() {
            $("#modalAlert").modal('hide');
        }


        function ChangePassword() {
            debugger;
            var isValid = true;
            var fileData = new FormData();
            var OldPassword = $("#OldPassword").val();
            var NewPassWord = $("#PassWord").val();
            var ConfirmPassword = $("#ConfirmPassword").val();

            if (NewPassWord == "") {
                $('#spnPassword').html('Please Enter Password');
                $('#spnPassword').removeClass('hide');
                isValid = false;
            } else if (NewPassWord.length > 20 || NewPassWord.length < 8) {
                $('#spnPassword').html('Password Should be manimum 8 and maximum 20 characters');
                $('#spnPassword').removeClass('hide');
                isValid = false;
            } else if (NewPassWord != ConfirmPassword) {
                $('#spnConfirmPassword').html('The Confirm Password passwords do not match.');
                $('#spnConfirmPassword').removeClass('hide');
                $('#spnPassword').html('');
                isValid = false;
            } else if (OldPassword == NewPassWord) {
                $('#spnPassword').html('Please Enter Diffrent Password to Old Password');
                $('#spnPassword').removeClass('hide');
                $('#spnConfirmPassword').html('');
                isValid = false;
            }
            else {
                debugger;
                var number = /([0-9])/;
                var alphabets = /([a-zA-Z])/;
                var special_characters = /([~,!,@@,#,$,%,^,&,*,-,_,+,=,?,>,<])/;

                if (NewPassWord.match(number) && NewPassWord.match(alphabets) && NewPassWord.match(special_characters)) {
                    $('#spnPassword').removeClass('hide');
                    isValid = true;
                } else {
                    $('#spnPassword').addClass('hide');
                    $('#spnPassword').html("Medium (should include alphabets, numbers and special characters.)");
                    isValid = false;
                }

            }
            if (!isValid) {
                $(window).scrollTop(0);
                return false;
            } else {
                debugger;
                fileData.append('UserID', $("#txtUserId").val());
                fileData.append('OldPassword', OldPassword);
                fileData.append('Password', NewPassWord);
                fileData.append('ConfirmPassword', ConfirmPassword);
                $.ajax({
                    url: $_ChangePassword,
                    data: fileData,
                    type: "POST",
                    dataType: "JSON",
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data,
                    success: function (data) {
                        debugger;
                        $('#ChangePassword').modal('hide');
                        if (data !== null && data.indexOf('html') < 0) {
                            if (data.indexOf('successfully') >= 0) {
                                displayMessage(data, 'success');
                                setTimeout(function () { location.href = gbl_login_url }, 2000);
                            }
                            else {
                                displayMessage(data, 'warning');

                            }
                            $("#btn_save").attr('disabled', false);
                        }
                        else {
                            displayMessage(data, 'error');
                            $("#btn_save").attr('disabled', false);
                            $("#loaderContainer").css("display", "none");
                        }

                    },
                    failure: function (response) {
                        displayMessage("failure    " + response.responseText, 'warning');
                    },
                    error: function (response) {
                        displayMessage("error   " + response.responseText, 'error');
                    }
                });
            }
            return true;
        }

        function Cancel() {
            $("#PassWord").val('');
            $("#ConfirmPassword").val('');
            $('#ChangePassword').modal('hide');
        }

        !function ($) {
            //eyeOpenClass: 'fa-eye',
            //eyeCloseClass: 'fa-eye-slash',
            'use strict';
            $(function () {
                $('[data-toggle="password"]').each(function () {
                    var input = $(this);
                    var eye_btn = $(this).parent().find('.input-group-text');
                    eye_btn.css('cursor', 'pointer').addClass('input-password-hide');
                    eye_btn.on('click', function () {
                        if (eye_btn.hasClass('input-password-hide')) {
                            eye_btn.removeClass('input-password-hide').addClass('input-password-show');
                            eye_btn.find('.fa').removeClass('fa-eye').addClass('fa-eye-slash')
                            input.attr('type', 'text');
                        } else {
                            eye_btn.removeClass('input-password-show').addClass('input-password-hide');
                            eye_btn.find('.fa').removeClass('fa-eye-slash').addClass('fa-eye')
                            input.attr('type', 'password');
                        }
                    });
                });
            });

        }(window.jQuery);
    </script>
</body>
</html>

